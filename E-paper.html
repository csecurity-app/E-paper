<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DAWN - Pakistan's Leading English Newspaper</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Times New Roman', serif;
      background-color: #f9f9f9;
      color: #111;
      margin: 0;
      padding: 0;
      line-height: 1.3;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 5px 10px;
    }

    .header {
      text-align: center;
      border-bottom: 2px solid #000;
      padding: 5px 0;
      margin-bottom: 5px;
    }

    .header h1 {
      font-size: 72px;
      margin: 0;
      font-weight: normal;
      letter-spacing: 1px;
      line-height: 1;
    }

    .header .date {
      font-size: 14px;
      margin-top: 2px;
    }

    .content {
      display: grid;
      grid-template-columns: 2.5fr 1fr;
      gap: 15px;
    }

    .main-column {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    /* Headline hierarchy */
    .article .headline-xxl {
      font-size: 32px;
      margin: 0 0 8px 0;
      font-weight: bold;
      line-height: 1.1;
      color: #000;
      border-bottom: 2px solid #000;
      padding-bottom: 5px;
    }

    .article .headline-xl {
      font-size: 28px;
      margin: 0 0 8px 0;
      font-weight: bold;
      line-height: 1.1;
      color: #000;
    }

    .article .headline-lg {
      font-size: 24px;
      margin: 0 0 7px 0;
      font-weight: bold;
      line-height: 1.2;
      color: #000;
    }

    .article .headline-md {
      font-size: 20px;
      margin: 0 0 6px 0;
      font-weight: bold;
      line-height: 1.2;
      color: #000;
    }

    .article .headline-sm {
      font-size: 18px;
      margin: 0 0 5px 0;
      font-weight: bold;
      line-height: 1.2;
      color: #000;
    }

    .article {
      margin-bottom: 12px;
      break-inside: avoid;
    }

    .article p {
      font-size: 14px;
      margin: 0 0 8px 0;
      text-align: justify;
    }

    .article .author {
      font-size: 12px;
      font-style: italic;
      margin-bottom: 5px;
    }

    .article .continued {
      font-size: 12px;
      color: #666;
    }

    .article-image {
      width: 100%;
      margin: 5px 0;
      border: 1px solid #ddd;
    }

    .article-image.large {
      height: 220px;
      object-fit: cover;
    }

    .article-image.medium {
      height: 160px;
      object-fit: cover;
    }

    .article-image.small {
      height: 110px;
      object-fit: cover;
    }

    .image-caption {
      font-size: 11px;
      color: #666;
      margin-top: -3px;
      margin-bottom: 5px;
      font-style: italic;
    }

    .sidebar {
      border-left: 1px solid #ccc;
      padding-left: 10px;
      display: grid;
      grid-template-rows: auto;
      gap: 12px;
    }

    .sidebar-article {
      margin-bottom: 12px;
    }

    .sidebar-image {
      width: 100%;
      height: 120px;
      object-fit: cover;
      margin: 5px 0;
      border: 1px solid #ddd;
    }

    .bullet-points {
      margin: 0 0 5px 0;
      padding-left: 15px;
      font-size: 14px;
    }

    .bullet-points li {
      margin-bottom: 5px;
    }

    .page-ref {
      font-weight: bold;
    }

    .two-column {
      column-count: 2;
      column-gap: 15px;
      font-size: 14px;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .small-text {
      font-size: 13px;
    }

    .editorial {
      font-style: italic;
      margin: 5px 0;
      font-size: 14px;
    }

    .lead-article {
      border-bottom: 1px solid #ddd;
      padding-bottom: 10px;
      margin-bottom: 10px;
    }

    .news-item {
      break-inside: avoid;
      page-break-inside: avoid;
    }

    /* NEW BUTTON STYLES */
    .news-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .news-actions button {
      padding: 6px 12px;
      border-radius: 18px;
      font-size: 12px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s;
    }

    .share-btn {
      background: #25D366;
      color: white;
      border: 1px solid #128C7E;
    }

    .save-btn {
      background: #FF9F43;
      color: white;
      border: 1px solid #E67E22;
    }

    .tts-btn {
      background: #3498DB;
      color: white;
      border: 1px solid #2980B9;
    }

    .news-actions button:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .news-actions button i {
      font-size: 14px;
    }

    .save-options {
      background: #F8F9FA;
      border: 1px solid #D92318;
      border-radius: 8px;
    }

    .save-options button {
      background: #D92318;
      color: white;
      transition: all 0.2s;
    }

    .save-options button:hover {
      background: #B21F1A;
    }

    #cancel-save-btn {
      background: #95A5A6;
      margin-top: 5px;
    }

    .tts-controls button {
      background: #2C3E50;
      color: white;
      transition: all 0.2s;
    }

    .tts-controls button:hover {
      background: #1A252F;
    }

    @media screen and (max-width: 768px) {
      .content {
        grid-template-columns: 1fr;
      }
      .main-column {
        grid-template-columns: 1fr;
      }
      .sidebar {
        border-left: none;
        padding-left: 0;
      }
      .two-column {
        column-count: 1;
      }
      
      .article .headline-xxl {
        font-size: 28px;
      }
      .article .headline-xl {
        font-size: 24px;
      }
      .article .headline-lg {
        font-size: 20px;
      }
    }

    .news-source-toggle {
    display: flex;
    justify-content: center;
    margin: 10px 0 15px;
    align-items: center;
    gap: 5px;
    border-bottom: 1px solid #ddd;
    padding-bottom: 10px;
  }

  .news-source-toggle button {
    padding: 8px 15px;
    border: none;
    border-radius: 20px;
    font-family: 'Times New Roman', serif;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 7px;
    background: #f5f5f5;
    color: #333;
    border: 1px solid #d92318;
  }

  .news-source-toggle button.active {
    background: #d92318;
    color: white;
    box-shadow: 0 2px 5px rgba(217, 35, 24, 0.3);
  }

  .news-source-toggle button:hover:not(.active) {
    background: #e6e6e6;
  }

  .location-status {
    margin-left: 15px;
    font-size: 13px;
    color: #666;
    display: flex;
    align-items: center;
    gap: 5px;
    font-style: italic;
  }

  @media (max-width: 768px) {
    .news-source-toggle {
      flex-wrap: wrap;
    }
    .location-status {
      margin-left: 0;
      width: 100%;
      justify-content: center;
      margin-top: 5px;
    }
  }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
        <!-- Add this right after the <div class="header"> in your existing code -->
<div class="news-source-toggle">
  <button id="local-news-btn" class="active">
    <i class="fas fa-map-marker-alt"></i> Local News
  </button>
  <button id="international-news-btn">
    <i class="fas fa-globe-asia"></i> International
  </button>
  <span class="location-status">
    <i class="fas fa-location-arrow"></i>
    <span id="location-text">Detecting your location...</span>
  </span>
</div>
      <h1>E DAILY</h1>
      <div class="date" id="current-date"></div>
    </div>

    <div class="content" id="news-container">
      <p>Loading news...</p>
    </div>
  </div>

  <div class="save-options" id="save-options">
    <button id="save-image-btn"><i class="fas fa-camera"></i> Save as Image</button>
    <button id="cancel-save-btn"><i class="fas fa-times"></i> Cancel</button>
  </div>

  <div class="tts-controls" id="tts-controls">
    <button id="tts-prev"><i class="fas fa-step-backward"></i></button>
    <button id="tts-play"><i class="fas fa-play"></i></button>
    <button id="tts-pause"><i class="fas fa-pause"></i></button>
    <button id="tts-next"><i class="fas fa-step-forward"></i></button>
    <button id="tts-stop"><i class="fas fa-stop"></i></button>
  </div>

  <script>
    // ====== DYNAMIC DATE SYSTEM ======
    function updateCurrentDate() {
      const now = new Date();
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      
      const dateString = now.toLocaleDateString('en-US', options);
      const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
      
      document.getElementById('current-date').textContent = 
        `${dateString.split(',')[0]}, ${dateString.split(',')[1]}, ${dateString.split(',')[2]} | ${timeString}`;
    }

    // ====== CONFIGURATION ======
    const API_KEY = "c7f341aac6b11c41f9f27dc74add84fd";
    const categories = ["general", "politics", "world", "business", "sports"];
    let currentCategory = 0;
    let articles = [];
    let currentTTSArticle = 0;
    let currentUtterance = null;
    let ttsQueue = [];

    // ====== INITIALIZATION ======
    document.addEventListener('DOMContentLoaded', () => {
      updateCurrentDate();
      setInterval(updateCurrentDate, 60000);
      fetchNews();
      setInterval(fetchNews, 120000);
    });

    // ====== NEWS FETCHING ======
    async function fetchNews() {
      try {
        const response = await fetch(
          `https://gnews.io/api/v4/top-headlines?category=${categories[currentCategory]}&lang=en&max=10&token=${API_KEY}`
        );
        const data = await response.json();
        articles = data.articles;
        renderNews();
      } catch (error) {
        console.error("Error fetching news:", error);
        container.innerHTML = `<p>Could not load news. Please check your connection.</p>`;
      }
    }

    // ====== RENDER NEWS ======
    function renderNews() {
      const container = document.getElementById('news-container');
      container.innerHTML = '';
      
      const mainColumn = document.createElement('div');
      mainColumn.className = 'main-column';
      
      const sidebar = document.createElement('div');
      sidebar.className = 'sidebar';
      
      articles.forEach((article, index) => {
        const importance = index < 3 ? 0 : index < 6 ? 1 : index < 9 ? 2 : 3;
        const articleDiv = document.createElement('div');
        articleDiv.className = 'article';
        articleDiv.dataset.articleIndex = index;
        
        articleDiv.innerHTML = `
          ${index === 0 ? '<span class="breaking-badge">BREAKING</span>' : ''}
          <h2 class="${getHeadlineStyle(importance)}">${article.title}</h2>
          <p class="author">By ${article.author || article.source.name}</p>
          ${article.image ? `<img src="${article.image}" class="article-image ${importance < 2 ? 'large' : 'medium'}" alt="${article.title}">` : ''}
          <p class="image-caption">${article.source.name}</p>
          <div class="${index < 2 ? 'two-column' : ''}">
            <p>${article.description || ''}</p>
            ${article.content ? `<p>${article.content.substring(0, 200)}</p>` : ''}
          </div>
          <div class="news-actions">
            <button class="share-btn" data-index="${index}"><i class="fas fa-share-alt"></i> Share</button>
            <button class="save-btn" data-index="${index}"><i class="fas fa-camera"></i> Save</button>
            <button class="tts-btn" data-index="${index}"><i class="fas fa-volume-up"></i> Listen</button>
          </div>
          ${index < 3 ? `<p class="continued">Continued on <span class="page-ref">Page ${Math.floor(Math.random() * 5) + 2}</span></p>` : ''}
        `;
        
        (index < 6 ? mainColumn : sidebar).appendChild(articleDiv);
      });
      
      container.appendChild(mainColumn);
      container.appendChild(sidebar);
      setupEventListeners();
    }

    function getHeadlineStyle(importance) {
      const styles = ['headline-xxl', 'headline-xl', 'headline-lg', 'headline-md'];
      return styles[importance] || 'headline-md';
    }

    function setupEventListeners() {
      document.querySelectorAll('.share-btn').forEach(btn => {
        btn.addEventListener('click', shareArticle);
      });

      document.querySelectorAll('.save-btn').forEach(btn => {
        btn.addEventListener('click', showSaveOptions);
      });

      document.querySelectorAll('.tts-btn').forEach(btn => {
        btn.addEventListener('click', startTTSForArticle);
      });
    }

    function shareArticle(e) {
      const index = e.target.closest('button').dataset.index;
      const article = articles[index];
      const text = `*${article.title}*\n\n${article.description || ''}\n\nRead more: ${article.url}`;
      window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
    }

    function showSaveOptions(e) {
      const card = e.target.closest('.article');
      const saveOptions = document.getElementById('save-options');
      saveOptions.style.display = 'block';
      document.getElementById('save-image-btn').onclick = () => saveArticleAsImage(card);
    }

    function saveArticleAsImage(card) {
      html2canvas(card, {
        scale: 2,
        backgroundColor: '#f9f9f9',
        logging: false
      }).then(canvas => {
        const link = document.createElement('a');
        link.download = `dawn-news-${new Date().getTime()}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
        showNotification('Article saved to your photos!');
        document.getElementById('save-options').style.display = 'none';
      });
    }

    document.getElementById('cancel-save-btn').addEventListener('click', () => {
      document.getElementById('save-options').style.display = 'none';
    });

    function startTTSForArticle(e) {
      const index = parseInt(e.target.closest('button').dataset.index);
      currentTTSArticle = index;
      ttsQueue = [index];
      const ttsControls = document.getElementById('tts-controls');
      ttsControls.style.display = 'flex';
      playNextInQueue();
    }

    function playNextInQueue() {
      if (ttsQueue.length === 0) return stopTTS();
      
      currentTTSArticle = ttsQueue.shift();
      const article = articles[currentTTSArticle];
      const text = `${article.title}. ${article.description || ''}`;
      
      window.speechSynthesis.cancel();
      currentUtterance = new SpeechSynthesisUtterance(text);
      currentUtterance.onend = playNextInQueue;
      window.speechSynthesis.speak(currentUtterance);
      highlightCurrentArticle();
    }

    function stopTTS() {
      window.speechSynthesis.cancel();
      document.getElementById('tts-controls').style.display = 'none';
      removeHighlight();
    }

    function highlightCurrentArticle() {
      removeHighlight();
      const article = document.querySelector(`.article[data-article-index="${currentTTSArticle}"]`);
      if (article) article.style.boxShadow = '0 0 0 2px #d92318';
    }

    function removeHighlight() {
      document.querySelectorAll('.article').forEach(article => {
        article.style.boxShadow = '';
      });
    }

    document.getElementById('tts-play').addEventListener('click', () => window.speechSynthesis.resume());
    document.getElementById('tts-pause').addEventListener('click', () => window.speechSynthesis.pause());
    document.getElementById('tts-prev').addEventListener('click', () => {
      if (currentTTSArticle > 0) {
        ttsQueue.unshift(currentTTSArticle - 1);
        window.speechSynthesis.cancel();
      }
    });
    document.getElementById('tts-next').addEventListener('click', () => {
      if (currentTTSArticle < articles.length - 1) {
        ttsQueue.unshift(currentTTSArticle + 1);
        window.speechSynthesis.cancel();
      }
    });
    document.getElementById('tts-stop').addEventListener('click', stopTTS);

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.position = 'fixed';
      notification.style.bottom = '20px';
      notification.style.left = '50%';
      notification.style.transform = 'translateX(-50%)';
      notification.style.background = 'rgba(0,0,0,0.8)';
      notification.style.color = 'white';
      notification.style.padding = '10px 20px';
      notification.style.borderRadius = '20px';
      notification.style.zIndex = '1000';
      notification.style.animation = 'fadeInOut 3s forwards';
      document.body.appendChild(notification);

      setTimeout(() => notification.remove(), 3000);
    }

// Add this to your existing JavaScript
  document.addEventListener('DOMContentLoaded', function() {
    const localBtn = document.getElementById('local-news-btn');
    const intlBtn = document.getElementById('international-news-btn');
    const locationText = document.getElementById('location-text');
    let userCountry = 'pk'; // Default to Pakistan

    // Set up button interactions
    localBtn.addEventListener('click', () => {
      if (!localBtn.classList.contains('active')) {
        localBtn.classList.add('active');
        intlBtn.classList.remove('active');
        loadLocalNews();
        locationText.innerHTML = `<i class="fas fa-home"></i> Viewing Pakistani perspective`;
      }
    });

    intlBtn.addEventListener('click', () => {
      if (!intlBtn.classList.contains('active')) {
        intlBtn.classList.add('active');
        localBtn.classList.remove('active');
        loadInternationalNews();
        locationText.innerHTML = `<i class="fas fa-globe"></i> Viewing global perspective`;
      }
    });

    // Detect user country
    function detectCountry() {
      fetch('https://ipapi.co/json/')
        .then(response => response.json())
        .then(data => {
          userCountry = data.country.toLowerCase();
          updateCountryDisplay();
        })
        .catch(() => {
          userCountry = 'pk'; // Fallback to Pakistan
          updateCountryDisplay();
        });
    }

    function updateCountryDisplay() {
      if (userCountry === 'pk') {
        localBtn.click(); // Auto-select local for Pakistan
      } else {
        locationText.innerHTML = 
          `<i class="fas fa-plane-departure"></i> Pakistani reader abroad (${userCountry.toUpperCase()})`;
        intlBtn.click(); // Auto-select international for others
      }
    }

    // News loading functions
    function loadLocalNews() {
      fetchNews('country=pk');
    }

    function loadInternationalNews() {
      fetchNews('international=true');
    }

    // Initialize
    detectCountry();
  });

  // Modify your existing fetchNews function to accept parameters
  function fetchNews(params) {
    const API_KEY = "c7f341aac6b11c41f9f27dc74add84fd";
    const url = `https://gnews.io/api/v4/top-headlines?token=${API_KEY}&${params}`;
    
    // Your existing fetch implementation
    fetch(url)
      .then(response => response.json())
      .then(data => {
        articles = data.articles;
        renderNews();
      })
      .catch(error => {
        console.error("Error fetching news:", error);
        container.innerHTML = `<p>Could not load news. Please check your connection.</p>`;
      });
  }
    
  </script>
</body>
</html>
